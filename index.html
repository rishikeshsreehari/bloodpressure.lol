<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Blood Pressure Tracker</title>
<style>
    table {
        border-collapse: collapse;
        width: 100%;
    }
    th, td {
        border: 1px solid #ddd;
        padding: 8px;
        text-align: left;
    }
    th {
        background-color: #f2f2f2;
    }
    
    /* Print Styles */
    @media print {
        table {
            border-collapse: collapse;
            width: 100%;
        }
        th, td {
            border: 1px solid #000; /* Change border color for printing */
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
        }
    }

    .edit-icon, .delete-icon, .check-button {
        cursor: pointer;
        font-size: 16px;
        margin-right: 5px;
    }

    .edit-icon:hover, .delete-icon:hover, .check-button:hover {
        color: #333;
    }

    .edit-button, .check-button {
        display: none;
    }
</style>
</head>
<body>
<h1>Blood Pressure Tracker</h1>
<form id="bpForm">
    <label for="time">Time:</label>
    <input type="datetime-local" id="time" name="time" required><br><br>
    
    <label for="systolic">Systolic (mm Hg):</label>
    <input type="number" id="systolic" name="systolic" required><br><br>
    
    <label for="diastolic">Diastolic (mm Hg):</label>
    <input type="number" id="diastolic" name="diastolic" required><br><br>
    
    <label for="pulse">Pulse (bpm):</label>
    <input type="number" id="pulse" name="pulse" required><br><br>
    
    <label for="hand">Hand (L/R):</label>
    <select id="hand" name="hand" required>
        <option value="L">Left</option>
        <option value="R">Right</option>
    </select><br><br>
    
    <label for="remarks">Remarks:</label><br>
    <textarea id="remarks" name="remarks"></textarea><br><br>
    
    <button type="button" onclick="saveEntry()">Save Entry</button>
    <button type="button" onclick="exportCSV()">Export CSV</button>
    <button type="button" onclick="printTable()">Print as PDF</button>
</form>

<h2>Entries</h2>
<table id="entryTable">
    <thead>
        <tr>
            <th>Time</th>
            <th>Systolic (mm Hg)</th>
            <th>Diastolic (mm Hg)</th>
            <th>Pulse (bpm)</th>
            <th>Hand (L/R)</th>
            <th>Remarks</th>
            <th>Action</th>
        </tr>
    </thead>
    <tbody id="entryBody">
    </tbody>
</table>

<script>
function saveEntry() {
    var time = document.getElementById("time").value;
    var systolic = document.getElementById("systolic").value;
    var diastolic = document.getElementById("diastolic").value;
    var pulse = document.getElementById("pulse").value;
    var hand = document.getElementById("hand").value;
    var remarks = document.getElementById("remarks").value;

    var entry = {
        time: time,
        systolic: systolic,
        diastolic: diastolic,
        pulse: pulse,
        hand: hand,
        remarks: remarks
    };

    var entries = JSON.parse(localStorage.getItem("entries")) || [];
    entries.push(entry);
    localStorage.setItem("entries", JSON.stringify(entries));

    displayEntries();
    document.getElementById("bpForm").reset();
}

function displayEntries() {
    var entries = JSON.parse(localStorage.getItem("entries")) || [];
    var tableBody = document.getElementById("entryBody");
    tableBody.innerHTML = "";

    entries.forEach(function(entry, index) {
        var row = document.createElement("tr");
        row.innerHTML = `
            <td>${entry.time}</td>
            <td>${entry.systolic}</td>
            <td>${entry.diastolic}</td>
            <td>${entry.pulse}</td>
            <td>${entry.hand}</td>
            <td>${entry.remarks}</td>
            <td>
                <span class="edit-icon" onclick="toggleEdit(${index})">&#9998;</span>
                <span class="check-button" onclick="saveEditedEntry(${index})">&#10004;</span>
                <span class="delete-icon" onclick="deleteEntry(${index})">&#10006;</span>
            </td>
        `;
        tableBody.appendChild(row);
    });
}

function toggleEdit(index) {
    var row = document.getElementById("entryBody").rows[index];
    var editIcons = row.getElementsByClassName("edit-icon");
    var checkButtons = row.getElementsByClassName("check-button");
    var cells = row.getElementsByTagName("td");

    if (editIcons.length > 0) {
        for (var i = 0; i < cells.length - 1; i++) {
            cells[i].setAttribute("contenteditable", "true");
        }

        for (var i = 0; i < editIcons.length; i++) {
            editIcons[i].style.display = "none";
        }

        for (var i = 0; i < checkButtons.length; i++) {
            checkButtons[i].style.display = "inline";
        }
    }
}

function saveEditedEntry(index) {
    var entries = JSON.parse(localStorage.getItem("entries")) || [];
    var row = document.getElementById("entryBody").rows[index];
    var editedEntry = {
        time: row.cells[0].textContent,
        systolic: row.cells[1].textContent,
        diastolic: row.cells[2].textContent,
        pulse: row.cells[3].textContent,
        hand: row.cells[4].textContent,
        remarks: row.cells[5].textContent
    };
    entries[index] = editedEntry;
    localStorage.setItem("entries", JSON.stringify(entries));
    displayEntries();
}

function deleteEntry(index) {
    var entries = JSON.parse(localStorage.getItem("entries")) || [];
    entries.splice(index, 1);
    localStorage.setItem("entries", JSON.stringify(entries));
    displayEntries();
}

function exportCSV() {
    var entries = JSON.parse(localStorage.getItem("entries")) || [];
    var csvContent = "data:text/csv;charset=utf-8,";
    csvContent += "Time,Systolic (mm Hg),Diastolic (mm Hg),Pulse (bpm),Hand (L/R),Remarks\n";

    entries.forEach(function(entry) {
        csvContent += `${entry.time},${entry.systolic},${entry.diastolic},${entry.pulse},${entry.hand},${entry.remarks}\n`;
    });

    var encodedUri = encodeURI(csvContent);
    var link = document.createElement("a");
    link.setAttribute("href", encodedUri);
    link.setAttribute("download", "blood_pressure_data.csv");
    document.body.appendChild(link); // Required for Firefox
    link.click();
}

function printTable() {
    var printWindow = window.open('', '', 'height=600,width=800');
    printWindow.document.write('<html><head><title>Print</title>');
    printWindow.document.write('</head><body>');
    printWindow.document.write(document.getElementById("entryTable").outerHTML);
    printWindow.document.write('<style>');
    printWindow.document.write('table { border-collapse: collapse; width: 100%; }');
    printWindow.document.write('th, td { border: 1px solid #000; padding: 8px; text-align: left; }');
    printWindow.document.write('th { background-color: #f2f2f2; }');
    printWindow.document.write('.edit-icon, .delete-icon, .check-button { cursor: pointer; font-size: 16px; margin-right: 5px; }');
    printWindow.document.write('.edit-icon:hover, .delete-icon:hover, .check-button:hover { color: #333; }');
    printWindow.document.write('.edit-button, .check-button { display: none; }');
    printWindow.document.write('</style>');
    printWindow.document.write('</body></html>');
    printWindow.document.close();
    printWindow.print();
}

displayEntries();
</script>
</body>
</html>
